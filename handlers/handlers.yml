---
- name: Reboot system
  ansible.builtin.reboot:
    msg: "Rebooting to apply SELinux changes"

- name: Restart hiavd service
  ansible.builtin.systemd_service:
    name: hiavd
    state: restarted

- name: Restart network
  ansible.builtin.service:
    name: NetworkManager
    state: restarted

- name: Restart NTP
  ansible.builtin.service:
    name: ntpd
    state: restarted

- name: Remove IPMI user setup script
  ansible.builtin.file:
    state: absent
    path: "{{ ipmi_setup_script_path }}"

- name: Reload udev rules
  ansible.builtin.command:
    cmd: "{{ item }}"
  with_items:
    - udevadm control --reload-rules
    - udevadm trigger --subsystem-match=net --action=add
